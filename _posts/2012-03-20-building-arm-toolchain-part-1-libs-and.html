---
layout: post
title: "Building ARM toolchain - part 1: libs and binutils"
date: 2012-03-20T23:25:00+01:00
categories:
 - embedded
---

<div class='post'>
<span style="font-family: 'Courier New', Courier, monospace;">Searching the internet for information on how to build arm toolchain from scratch I realize that it is very hard to find &nbsp;information about this matter (and recent one even harder). I will try to fill this lack of information and try to build toolchain. My main goal is to use a component based on the GNU public license, and using them in as the newest version as it is possible.</span>
<br />
<br />
<span style="font-family: 'Courier New', Courier, monospace;">What is toolchain ? (according to wikipedia):</span><br />
<span style="font-family: 'Courier New', Courier, monospace;"></span><br />
<blockquote>
<span style="font-family: 'Courier New', Courier, monospace;">In software, a toolchain is the set of programming tools that are used to create&nbsp;a product (typically another computer program or system of programs). The tools&nbsp;may be used in a chain, so that the output of each tool becomes the input for&nbsp;the next, but the term is used widely to refer to any set of linked development&nbsp;tools.</span></blockquote>
<br />
<span style="font-family: 'Courier New', Courier, monospace;">Requirements:</span><br />
<span style="font-family: 'Courier New', Courier, monospace;">- Cross compiler, I create one using corsstool-ng and describe this process in&nbsp;<a href="http://pietrushnic.blogspot.com/2012/03/quick-build-of-arm-unknown-linux.html">previous post</a>. I will use arm-unknown-linux-gnueabi as entry point compiler.</span>
<span style="font-family: 'Courier New', Courier, monospace;">- $TARGET is defined as my destination directory</span>
<br />
<pre class="brush:bash;gutter:false">export TARGET=/home/pietrushnic/sandbox/toolchain</pre>
<br />
<span style="font-family: 'Courier New', Courier, monospace;">Procedure:</span><br />
<ol>
<li><span style="font-family: 'Courier New', Courier, monospace;">Kernel header files:</span></li>
<ol type="a">
<li><span style="font-family: 'Courier New', Courier, monospace;">clone linux git repository
<pre class="brush:bash;gutter:false">git clone git://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git</pre>
</span></li>
<li><span style="font-family: 'Courier New', Courier, monospace;">install headers $TARGET is home of our toolchain</span>
<pre class="brush:bash;gutter:false">make ARCH=arm INSTALL\_HDR\_PATH=\$TARGET/usr headers\_install</pre>
</li>
</ol>
<li><span style="font-family: 'Courier New', Courier, monospace;">Libraries (gmp, mpfr, mpc)</span>
<ol type="a">
<li><span style="font-family: 'Courier New', Courier, monospace;">GMP (<i>GNU Multiple Precision Arithmetic Library</i>) - changeset used: 14765:0acae62fa162</span>
<ul>
<li><span style="font-family: 'Courier New', Courier, monospace;">As I said before I use "latest greatest" ;P version, and for gmp we can reach it using:</span><pre class="brush:bash;gutter:false">hg clone http://gmplib.org:8000/gmp</pre>
</li>
<li><span style="font-family: 'Courier New', Courier, monospace;">create configuration files</span>
<pre class="brush:bash;gutter:false">./.bootstrap</pre>
</li>
<li><span style="font-family: 'Courier New', Courier, monospace;">configure</span>
<pre class="brush:bash;gutter:false">./configure --prefix=$TARGET/arm-x-tools --enable-shared=n \
--enable-static</pre>
</li>
<li><span style="font-family: 'Courier New', Courier, monospace;">compile</span>
<pre class="brush:bash;gutter:false">make
make check
make install</pre>
</li>
</ul>
</li>
<li><span style="font-family: 'Courier New', Courier, monospace;">MPFR (<i>GNU Multiple Precision Floating-Point Reliably</i>) - version: r8103</span>
<ul>
<li><span style="font-family: 'Courier New', Courier, monospace;">get latest version</span>
<pre class="brush:bash;gutter:false">svn checkout svn://scm.gforge.inria.fr/svn/mpfr/trunk mpfr</pre>
</li>
<li><span style="font-family: 'Courier New', Courier, monospace;">create configuration file</span>
<pre class="brush:bash;gutter:false">autoreconf -i</pre>
</li>
<li><span style="font-family: 'Courier New', Courier, monospace;">configure</span>
<pre class="brush:bash;gutter:false">./configure --prefix=$TARGET/arm-x-tools --enable-thread-safe \
--with-gmp=$TARGET/arm-x-tools --disable-shared --enable-static</pre>
</li>
<li><span style="font-family: 'Courier New', Courier, monospace;">compile</span>
<pre class="brush:bash;gutter:false">make
make install</pre>
</li>
</ul>
</li>
<li><span style="font-family: 'Courier New', Courier, monospace;">MPC (<i>Multiple Precision Complex</i>)- version: r1146</span>
<ul>
<li><span style="font-family: 'Courier New', Courier, monospace;">checkout svn</span>
<pre class="brush:bash;gutter:false">svn checkout svn://scm.gforge.inria.fr/svnroot/mpc/trunk mpc</pre>
</li>
<li><span style="font-family: 'Courier New', Courier, monospace;">create configuration file</span>
<pre class="brush:bash;gutter:false">autoreconf -i</pre>
</li>
<li><span style="font-family: 'Courier New', Courier, monospace;">configure</span>
<pre class="brush:bash;gutter:false">./configure --prefix=$TARGET/arm-x-tools \
--with-gmp=$TARGET/arm-x-tools --with-mpfr=$TARGET/arm-x-tools \
--disable-shared --enable-static</pre>
</li>
<li><span style="font-family: 'Courier New', Courier, monospace;">compile</span>
<pre class="brush:bash;gutter:false">make
make install</pre>
</li>
</ul>
</li>
</ol>
</li>
<li><span style="font-family: 'Courier New', Courier, monospace;">Binutils - collection of a GNU binary tools:</span>
<ul>
<li><span style="font-family: 'Courier New', Courier, monospace;">checkout version from anonymous cvs</span>
<pre class="brush:bash;gutter:false">cvs -z 9 -d :pserver:anoncvs@sourceware.org:/cvs/src login</pre>
<span style="font-family: 'Courier New', Courier, monospace;">create directory for checkout</span>
<pre class="brush:bash;gutter:false">mkdir binutils</pre>
<span style="font-family: 'Courier New', Courier, monospace;">checkout sources</span>
<pre class="brush:bash;gutter:false">cvs -z 9 -d :pserver:anoncvs@sourceware.org:/cvs/src co binutils</pre>
</li>
<li><span style="font-family: 'Courier New', Courier, monospace;">configure</span>
<pre class="brush:bash;gutter:false">LDFLAGS="-Wl,-rpath -Wl,$TARGET/arm-x-tools/lib" ./configure \
--build=x86_64-pc-linux-gnu --host=x86_64-pc-linux-gnu \
--target=arm-unknown-linux-gnueabi --prefix=$TARGET/arm-x-tools \
--disable-nls --disable-multilib --disable-werror --with-float=soft \
--with-gmp=$TARGET/arm-x-tools --with-mpfr=$TARGET/arm-x-tools \
--with-mpc=$TARGET/arm-x-tools --with-sysroot=$TARGET
</pre>
</li>
<li><span style="font-family: 'Courier New', Courier, monospace;">compile</span>
<pre class="brush:bash;gutter:false">make configure-host
make
make install</pre>
</li>
<li><span style="font-family: 'Courier New', Courier, monospace;">to check if everything was made correctly</span>
<pre class="brush:bash;gutter:false">ldd $TARGET/arm-x-tools/bin/arm-unknown-linux-gnueabi-ldd</pre>
<span style="font-family: 'Courier New', Courier, monospace;">it should show that it use library compiled previously by us:</span>
<pre class="brush:bash;gutter:false">libz.so.1 =&gt; /home/pietrushnic/sandbox/toolchain/arm-x-tools/lib/libz.so.1 \
(0x00007f0086cc5000)</pre>
</li>
</ul>
</li>
</ol>
<span style="font-family: 'Courier New', Courier, monospace;">This set gives us a solid base to build the compiler. However, it will be in the next section.</span></div>
