
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>0x6: Root file system for embedded system - pietrushnic's world</title>
  <meta name="author" content="pietrushnic">

  
  <meta name="description" content="How to configure root file system for Virtual Development Board ?">
  <meta name="keywords" content="rootfs, busybox, linux, virtual development board">

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://pietrushnic.github.io/blog/2013/06/07/root-file-system-for-embedded-system">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="pietrushnic's world" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-39420295-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">pietrushnic's world</a></h1>
  
    <h2>|| 933k' dr34M2 0F Phr33D0m</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:pietrushnic.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/projects">Projects</a></li>
  <li><a href="/about">About Me</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
<header>
  
  <h1 class="entry-title">0x6: Root file system for embedded system</h1>
  
  
  <p class="meta">
  








  <img class="center" src="/assets/images/icons/clock.ico" width="12" height="12">



<time datetime="2013-06-07T10:40:00+02:00" pubdate data-updated="true">Jun 7<span>th</span>, 2013</time>
  <span class="word-count">Words: 2875</span>
  <img class="center" src="/assets/images/icons/category.ico" width="16" height="16">
  
  
  <a href="/blog/categories/embedded">embedded</a>
  ,
  
  <a href="/blog/categories/linux">linux</a>
  ,
  
  <a href="/blog/categories/vdb">vdb</a>
  
  
  
  
  <img class="comment-icon" src="/assets/images/icons/comment_cloud.png" height="16" width="16">
  <a href="#disqus_thread">Comments</a>
  
  </p>
  
</header>


<div class="entry-content"><h2>Table of contents</h2>

<ul>
<li><a href="/blog/2013/06/07/root-file-system-for-embedded-system/#intro">Introduction</a></li>
<li><a href="/blog/2013/06/07/root-file-system-for-embedded-system/#get-bb">Get and build BusyBox</a></li>
<li><a href="/blog/2013/06/07/root-file-system-for-embedded-system/#fast-and-simple">Fast and simple</a></li>
<li><a href="/blog/2013/06/07/root-file-system-for-embedded-system/#setting-up-kernel-through-nfs">Setting up kernel through NFS</a></li>
<li><a href="/blog/2013/06/07/root-file-system-for-embedded-system/#verify-configuration">Verify Configuration</a></li>
<li><a href="/blog/2013/06/07/root-file-system-for-embedded-system/#embedded-filesystem-tuning">Embedded filesystem tuning</a></li>
<li><a href="/blog/2013/06/07/root-file-system-for-embedded-system/#summary">Summary</a></li>
</ul>


<p><a id="intro"></a></p>

<h3>Introduction</h3>

<p>To make our embedded linux work as virtual development platform we need some
environment after booting. There is many approaches to get working root file
system but I will use the easiest one as an exercise. I don&rsquo;t want to create full
embedded distribution (this is good plan for future works). Right now I will be
happy with simple initramfs based on <a href="http://busybox.net/">BusyBox</a>.</p>

<p>For all interested in creating own root filesystem there are few places where
you can find informations:</p>

<ul>
<li><a href="http://lwn.net/Articles/210046/">Embedded Linux: Small Root Filesystems</a></li>
<li><a href="https://www.kernel.org/doc/Documentation/filesystems/ramfs-rootfs-initramfs.txt">ramfs-rootfs-initramfs</a></li>
<li><a href="http://processors.wiki.ti.com/index.php/Creating_a_Root_File_System_for_Linux_on_OMAP35x">Creating a Root File System for Linux on OMAP35x</a></li>
</ul>


<p><a id="get-bb"></a></p>

<h3>Get and build BusyBox</h3>

<p>Clone git repository:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>git clone git://git.busybox.net/busybox</span></code></pre></td></tr></table></div></figure>


<p><a id="fast-and-simple"></a></p>

<h3>Fast and simple</h3>

<p>Of course make sure to use correct toolchain. I made few notes about
Ubuntu/Linaro toolchain in <a href="/blog/2013/06/07/qemu-network-configuration-and-tftp-for-virtual-development-board/#ubuntu-issues">previous post</a></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>make ARCH=arm CROSS_COMPILE=arm-linux-gnueabi- menuconfig</span></code></pre></td></tr></table></div></figure>


<p>Mark <code>Busybox Settings -&gt; Build Options -&gt; Build BusyBox as a static binary (no
shared libs)</code> option. Exit and save.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>make ARCH=arm CROSS_COMPILE=arm-linux-gnueabi-
</span><span class='line'>make ARCH=arm CROSS_COMPILE=arm-linux-gnueabi- install
</span><span class='line'>cd _install/</span></code></pre></td></tr></table></div></figure>


<p><a id="setting-up-kernel-through-nfs"></a></p>

<h3>Setting up kernel through NFS</h3>

<p><a href="/blog/2013/06/07/linux-kernel-for-embedded-system">Previously</a> we prepared U-Boot
kenernel image with DHCP and rootfs which we want to expose over NFS. First lets start with NFS
configuration:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo apt-get install nfs-kernel-server</span></code></pre></td></tr></table></div></figure>


<p>I use simple <code>/etc/exports</code> configuration:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>/srv/homes 192.168.1.0/255.255.255.0(rw,sync,no_subtree_check,no_root_squash)</span></code></pre></td></tr></table></div></figure>


<p>Make sure that <code>/srv/homes</code> exist, if no than create it. After editing nfs
configuration file we have to restart NFS server:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo service nfs-kernel-server restart</span></code></pre></td></tr></table></div></figure>


<p><a id="verify-configuration"></a></p>

<h3>Verify configuration</h3>

<p>I assume that you go through all previous articles in this series.
To verify configuration we have to copy whole BusyBox <code>_install</code> directory to
known nfs location:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mkdir /srv/homes/rootfs
</span><span class='line'>sudo chmod 777 /srv/homes/rootfs
</span><span class='line'>cd /srv/homes/rootfs
</span><span class='line'>cp -R /path/to/busybox/_install/* .</span></code></pre></td></tr></table></div></figure>


<p>Now we can try our Virtual Development Board:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo qemu-system-arm -kernel src/u-boot/u-boot -net nic,vlan=0 -net \
</span><span class='line'>tap,vlan=0,ifname=tap0,script=/etc/qemu-ifup -nographic -M versatilepb</span></code></pre></td></tr></table></div></figure>


<p>After U-Boot booting:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>VersatilePB # setenv autload no
</span><span class='line'>VersatilePB # dhcp
</span><span class='line'>MC91111: PHY auto-negotiate timed out
</span><span class='line'>SMC91111: MAC 52:54:00:12:34:56
</span><span class='line'>BOOTP broadcast 1
</span><span class='line'>DHCP client bound to address 192.168.1.13
</span><span class='line'>VersatilePB # setenv serverip 192.168.1.24
</span><span class='line'>VersatilePB # setenv bootfile uImage
</span><span class='line'>VersatilePB # tftp</span></code></pre></td></tr></table></div></figure>


<p>Note that <code>192.168.1.24</code> should be replaced with correct address of TFTP server.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>VersatilePB # tftp
</span><span class='line'>SMC91111: PHY auto-negotiate timed out
</span><span class='line'>SMC91111: MAC 52:54:00:12:34:56
</span><span class='line'>Using SMC91111-0 device
</span><span class='line'>TFTP from server 192.168.1.20; our IP address is 192.168.1.13
</span><span class='line'>Filename 'uImage'.
</span><span class='line'>Load address: 0x7fc0
</span><span class='line'>Loading: #################################################################
</span><span class='line'>         #################################################################
</span><span class='line'>         #################################################################
</span><span class='line'>         #################################################################
</span><span class='line'>         #################################################################
</span><span class='line'>         ##################################################
</span><span class='line'>         252 KiB/s
</span><span class='line'>done
</span><span class='line'>Bytes transferred = 1917944 (1d43f8 hex)</span></code></pre></td></tr></table></div></figure>


<p>Right now we will set boot arguments for our kernel:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>setenv bootargs 'root=/dev/nfs mem=128M ip=dhcp netdev=25,0,0xf1010000,0xf1010010,eth0 nfsroot=192.168.1.20:/srv/homes/rootfs console=ttyAMA0'</span></code></pre></td></tr></table></div></figure>


<p>What does it mean:</p>

<ul>
<li><code>root=/dev/nfs</code> &ndash; following
<a href="https://www.kernel.org/doc/Documentation/filesystems/nfs/nfsroot.txt">kernel.org</a>:</li>
</ul>


<blockquote><p>This is necessary to enable the pseudo-NFS-device. Note that it&#8217;s not a<br/>real device but just a synonym to tell the kernel to use NFS instead of<br/>a real device.</p></blockquote>


<ul>
<li><code>mem=128M ip=dhcp</code> &ndash; self-explaining</li>
<li><code>netdev=25,0,0xf1010000,0xf1010010,eth0</code> &ndash; network device configuration
(<code>Format: &lt;irq&gt;,&lt;io&gt;,&lt;mem_start&gt;,&lt;mem_end&gt;,&lt;name&gt;</code>), this was provided by
default <code>U-Boot</code> bootargs</li>
<li><code>nfsroot=192.168.1.20:/srv/homes/rootfs</code> &ndash; NFS server ip and path to rootfs</li>
<li><code>console=ttyAMA0</code> &ndash; very importanat if you want to see anything in <code>-nographic</code> mode</li>
</ul>


<p>After setting bootargs we can boot our Virtual Development Board:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>bootm</span></code></pre></td></tr></table></div></figure>


<p>As you can see that&rsquo;s not all, our current configuration end with:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>(...)
</span><span class='line'>Sending DHCP requests .input: AT Raw Set 2 keyboard as 
</span><span class='line'>/devices/fpga:06/serio0/input/input0
</span><span class='line'>, OK
</span><span class='line'>IP-Config: Got DHCP answer from 192.168.1.1, my address is 192.168.1.13
</span><span class='line'>IP-Config: Complete:
</span><span class='line'>     device=eth0, hwaddr=52:54:00:12:34:56, ipaddr=192.168.1.13, mask=255.255.255.0, gw=192.168.1.1
</span><span class='line'>     host=192.168.1.13, domain=, nis-domain=(none)
</span><span class='line'>     bootserver=0.0.0.0, rootserver=192.168.1.20, rootpath=
</span><span class='line'>     nameserver0=192.168.1.1
</span><span class='line'>input: ImExPS/2 Generic Explorer Mouse as 
</span><span class='line'>/devices/fpga:07/serio1/input/input1
</span><span class='line'>VFS: Mounted root (nfs filesystem) on device 0:9.
</span><span class='line'>Freeing unused kernel memory: 112K (c034e000 - c036a000)
</span><span class='line'>nfs: server 192.168.1.20 not responding, still trying
</span><span class='line'>nfs: server 192.168.1.20 OK
</span><span class='line'>can't run '/etc/init.d/rcS': No such file or directory
</span><span class='line'>can't open /dev/tty2: No such file or directory
</span><span class='line'>can't open /dev/tty3: No such file or directory
</span><span class='line'>
</span><span class='line'>can't open /dev/tty4: No such file or directory
</span><span class='line'>can't open /dev/tty2: No such file or directory
</span><span class='line'>can't open /dev/tty3: No such file or directory
</span><span class='line'>can't open /dev/tty4: No such file or directory
</span><span class='line'>can't open /dev/tty2: No such file or directory
</span><span class='line'>can't open /dev/tty3: No such file or directory</span></code></pre></td></tr></table></div></figure>


<p>try to open ttys loop. This is because of default behavior of <code>BusyBox</code> when <code>inittab</code>
was not found.</p>

<p><a id="embedded-filesystem-tuning"></a></p>

<h3>Embedded filesystem tuning</h3>

<p>To override above behavior we have to create <code>/etc/inittab</code> file:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cd /srv/homes/rootfs
</span><span class='line'>mkdir etc
</span><span class='line'>vim etc/inittab</span></code></pre></td></tr></table></div></figure>


<p>Our <code>inittab</code> is very simple:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>::sysinit:/etc/init.d/rcS
</span><span class='line'>::askfirst:/bin/ash
</span><span class='line'>::ctrlaltdel:/sbin/reboot
</span><span class='line'>::shutdown:/sbin/swapoff -a
</span><span class='line'>::shutdown:/bin/umount -a -r
</span><span class='line'>::restart:/sbin/init</span></code></pre></td></tr></table></div></figure>


<p>If you want to learn more about inittab &ndash; <code>man inittab</code> .We need improve out filesystem with few directories:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mkdir sys proc etc/init.d</span></code></pre></td></tr></table></div></figure>


<p>In <code>/etc/init.d/rcS</code> we will mount sysfs and procfs:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c">#! /bin/sh</span>
</span><span class='line'>mount -t proc proc /proc
</span><span class='line'>mount -t sysfs sysfs /sys
</span></code></pre></td></tr></table></div></figure>


<p>Give executable permission to <code>rcS</code> script:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>chmod +x etc/init.d/rcS
</span></code></pre></td></tr></table></div></figure>


<p>We also have to create <code>dev</code> directory with <code>ttyAMA0</code> block device:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>mkdir dev
</span><span class='line'>sudo mknod dev/ttyAMA0 c 204 64
</span><span class='line'>sudo mknod dev/null c 1 3
</span><span class='line'>sudo mknod dev/console c 5 1
</span></code></pre></td></tr></table></div></figure>


<p>Right now we should be able to boot our Virtual Development Board. Let&rsquo;s try
again:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
<span class='line-number'>153</span>
<span class='line-number'>154</span>
<span class='line-number'>155</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>pietrushnic@eglarest:~<span class="nv">$ </span>sudo qemu-system-arm -m 256M -kernel src/u-boot/u-boot -net nic,vlan<span class="o">=</span>0 -net tap,vlan<span class="o">=</span>0,ifname<span class="o">=</span>tap0,script<span class="o">=</span>/etc/qemu-ifup -nographic -M versatilepb -net dump,file<span class="o">=</span>/tmp/dump.pcap
</span><span class='line'>Executing /etc/qemu-ifup
</span><span class='line'>Bringing up tap0 <span class="k">for </span>bridged mode...
</span><span class='line'>Adding tap0 to br0...
</span><span class='line'>oss: Could not initialize DAC
</span><span class='line'>oss: Failed to open <span class="sb">`</span>/dev/dsp<span class="s1">&#39;</span>
</span><span class='line'><span class="s1">oss: Reason: No such file or directory</span>
</span><span class='line'><span class="s1">oss: Could not initialize DAC</span>
</span><span class='line'><span class="s1">oss: Failed to open `/dev/dsp&#39;</span>
</span><span class='line'>oss: Reason: No such file or directory
</span><span class='line'>audio: Failed to create voice <span class="sb">`</span>lm4549.out<span class="s1">&#39;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="s1">U-Boot 2013.04-00274-ga71d45d (May 27 2013 - 17:36:14)</span>
</span><span class='line'>
</span><span class='line'><span class="s1">DRAM:  128 MiB</span>
</span><span class='line'><span class="s1">WARNING: Caches not enabled</span>
</span><span class='line'><span class="s1">Flash: 64 MiB</span>
</span><span class='line'><span class="s1">*** Warning - bad CRC, using default environment</span>
</span><span class='line'>
</span><span class='line'><span class="s1">In:    serial</span>
</span><span class='line'><span class="s1">Out:   serial</span>
</span><span class='line'><span class="s1">Err:   serial</span>
</span><span class='line'><span class="s1">Net:   SMC91111-0</span>
</span><span class='line'><span class="s1">Warning: SMC91111-0 using MAC address from net device</span>
</span><span class='line'>
</span><span class='line'><span class="s1">VersatilePB # setenv serverip 192.168.1.24</span>
</span><span class='line'><span class="s1">VersatilePB # setenv bootfile uImage</span>
</span><span class='line'><span class="s1">VersatilePB # setenv bootargs &#39;</span><span class="nv">root</span><span class="o">=</span>/dev/nfs <span class="nv">mem</span><span class="o">=</span>128M <span class="nv">ip</span><span class="o">=</span>dhcp <span class="nv">netdev</span><span class="o">=</span>25,0,0xf1010000,0xf1010010,eth0 <span class="nv">nfsroot</span><span class="o">=</span>192.168.1.24:/sv/homes/rootfs <span class="nv">console</span><span class="o">=</span>ttyAMA0<span class="s1">&#39;</span>
</span><span class='line'><span class="s1">VersatilePB # dhcp</span>
</span><span class='line'><span class="s1">SMC91111: PHY auto-negotiate timed out</span>
</span><span class='line'><span class="s1">SMC91111: MAC 52:54:00:12:34:56</span>
</span><span class='line'><span class="s1">BOOTP broadcast 1</span>
</span><span class='line'><span class="s1">DHCP client bound to address 192.168.1.13</span>
</span><span class='line'><span class="s1">Using SMC91111-0 device</span>
</span><span class='line'><span class="s1">TFTP from server 192.168.1.24; our IP address is 192.168.1.13</span>
</span><span class='line'><span class="s1">Filename &#39;</span>uImage<span class="s1">&#39;.</span>
</span><span class='line'><span class="s1">Load address: 0x7fc0</span>
</span><span class='line'><span class="s1">Loading: *############T #####################################################</span>
</span><span class='line'><span class="s1">  #################################################################</span>
</span><span class='line'><span class="s1">  #################################################################</span>
</span><span class='line'><span class="s1">  #################################################################</span>
</span><span class='line'><span class="s1">  #################################################################</span>
</span><span class='line'><span class="s1">  ##################################################</span>
</span><span class='line'><span class="s1">  0 Bytes/s</span>
</span><span class='line'><span class="s1">done</span>
</span><span class='line'><span class="s1">Bytes transferred = 1917944 (1d43f8 hex)</span>
</span><span class='line'><span class="s1">VersatilePB # bootm</span>
</span><span class='line'><span class="s1">## Booting kernel from Legacy Image at 00007fc0 ...</span>
</span><span class='line'><span class="s1">   Image Name:   Linux-3.10.0-rc3</span>
</span><span class='line'><span class="s1">   Image Type:   ARM Linux Kernel Image (uncompressed)</span>
</span><span class='line'><span class="s1">   Data Size:    1917880 Bytes = 1.8 MiB</span>
</span><span class='line'><span class="s1">   Load Address: 00008000</span>
</span><span class='line'><span class="s1">   Entry Point:  00008000</span>
</span><span class='line'><span class="s1">   XIP Kernel Image ... OK</span>
</span><span class='line'><span class="s1">OK</span>
</span><span class='line'>
</span><span class='line'><span class="s1">Starting kernel ...</span>
</span><span class='line'>
</span><span class='line'><span class="s1">Uncompressing Linux... done, booting the kernel.</span>
</span><span class='line'><span class="s1">Booting Linux on physical CPU 0x0</span>
</span><span class='line'><span class="s1">Linux version 3.10.0-rc3 (pietrushnic@eglarest) (gcc version 4.7.2 (Debian 4.7.2-4) ) #2 Sun Jun 2 20:25:23 CEST 2013</span>
</span><span class='line'><span class="s1">CPU: ARM926EJ-S [41069265] revision 5 (ARMv5TEJ), cr=00093177</span>
</span><span class='line'><span class="s1">CPU: VIVT data cache, VIVT instruction cache</span>
</span><span class='line'><span class="s1">Machine: ARM-Versatile PB</span>
</span><span class='line'><span class="s1">Memory policy: ECC disabled, Data cache writeback</span>
</span><span class='line'><span class="s1">sched_clock: 32 bits at 24MHz, resolution 41ns, wraps every 178956ms</span>
</span><span class='line'><span class="s1">Built 1 zonelists in Zone order, mobility grouping on.  Total pages: 32512</span>
</span><span class='line'><span class="s1">Kernel command line: root=/dev/nfs mem=128M ip=dhcp netdev=25,0,0xf1010000,0xf1010010,eth0 nfsroot=192.168.1.24:/srv/homes/rootfs console=ttyAMA0</span>
</span><span class='line'><span class="s1">PID hash table entries: 512 (order: -1, 2048 bytes)</span>
</span><span class='line'><span class="s1">Dentry cache hash table entries: 16384 (order: 4, 65536 bytes)</span>
</span><span class='line'><span class="s1">Inode-cache hash table entries: 8192 (order: 3, 32768 bytes)</span>
</span><span class='line'><span class="s1">Memory: 128MB = 128MB total</span>
</span><span class='line'><span class="s1">Memory: 126136k/126136k available, 4936k reserved, 0K highmem</span>
</span><span class='line'><span class="s1">Virtual kernel memory layout:</span>
</span><span class='line'><span class="s1">    vector  : 0xffff0000 - 0xffff1000   (   4 kB)</span>
</span><span class='line'><span class="s1">    fixmap  : 0xfff00000 - 0xfffe0000   ( 896 kB)</span>
</span><span class='line'><span class="s1">    vmalloc : 0xc8800000 - 0xff000000   ( 872 MB)</span>
</span><span class='line'><span class="s1">    lowmem  : 0xc0000000 - 0xc8000000   ( 128 MB)</span>
</span><span class='line'><span class="s1">    modules : 0xbf000000 - 0xc0000000   (  16 MB)</span>
</span><span class='line'><span class="s1">      .text : 0xc0008000 - 0xc034dd58   (3352 kB)</span>
</span><span class='line'><span class="s1">      .init : 0xc034e000 - 0xc036ae8c   ( 116 kB)</span>
</span><span class='line'><span class="s1">      .data : 0xc036c000 - 0xc0391de0   ( 152 kB)</span>
</span><span class='line'><span class="s1">       .bss : 0xc0391de0 - 0xc03ad6cc   ( 111 kB)</span>
</span><span class='line'><span class="s1">NR_IRQS:224</span>
</span><span class='line'><span class="s1">VIC @f1140000: id 0x00041190, vendor 0x41</span>
</span><span class='line'><span class="s1">FPGA IRQ chip 0 &quot;SIC&quot; @ f1003000, 13 irqs</span>
</span><span class='line'><span class="s1">Console: colour dummy device 80x30</span>
</span><span class='line'><span class="s1">Calibrating delay loop... 649.21 BogoMIPS (lpj=3246080)</span>
</span><span class='line'><span class="s1">pid_max: default: 32768 minimum: 301</span>
</span><span class='line'><span class="s1">Mount-cache hash table entries: 512</span>
</span><span class='line'><span class="s1">CPU: Testing write buffer coherency: ok</span>
</span><span class='line'><span class="s1">Setting up static identity map for 0xc0286e90 - 0xc0286ee8</span>
</span><span class='line'><span class="s1">NET: Registered protocol family 16</span>
</span><span class='line'><span class="s1">DMA: preallocated 256 KiB pool for atomic coherent allocations</span>
</span><span class='line'><span class="s1">Serial: AMBA PL011 UART driver</span>
</span><span class='line'><span class="s1">dev:f1: ttyAMA0 at MMIO 0x101f1000 (irq = 44) is a PL011 rev1</span>
</span><span class='line'><span class="s1">console [ttyAMA0] enabled</span>
</span><span class='line'><span class="s1">dev:f2: ttyAMA1 at MMIO 0x101f2000 (irq = 45) is a PL011 rev1</span>
</span><span class='line'><span class="s1">dev:f3: ttyAMA2 at MMIO 0x101f3000 (irq = 46) is a PL011 rev1</span>
</span><span class='line'><span class="s1">fpga:09: ttyAMA3 at MMIO 0x10009000 (irq = 70) is a PL011 rev1</span>
</span><span class='line'><span class="s1">bio: create slab &lt;bio-0&gt; at 0</span>
</span><span class='line'><span class="s1">Switching to clocksource timer3</span>
</span><span class='line'><span class="s1">NET: Registered protocol family 2</span>
</span><span class='line'><span class="s1">TCP established hash table entries: 1024 (order: 1, 8192 bytes)</span>
</span><span class='line'><span class="s1">TCP bind hash table entries: 1024 (order: 0, 4096 bytes)</span>
</span><span class='line'><span class="s1">TCP: Hash tables configured (established 1024 bind 1024)</span>
</span><span class='line'><span class="s1">TCP: reno registered</span>
</span><span class='line'><span class="s1">UDP hash table entries: 256 (order: 0, 4096 bytes)</span>
</span><span class='line'><span class="s1">UDP-Lite hash table entries: 256 (order: 0, 4096 bytes)</span>
</span><span class='line'><span class="s1">NET: Registered protocol family 1</span>
</span><span class='line'><span class="s1">RPC: Registered named UNIX socket transport module.</span>
</span><span class='line'><span class="s1">RPC: Registered udp transport module.</span>
</span><span class='line'><span class="s1">RPC: Registered tcp transport module.</span>
</span><span class='line'><span class="s1">RPC: Registered tcp NFSv4.1 backchannel transport module.</span>
</span><span class='line'><span class="s1">NetWinder Floating Point Emulator V0.97 (double precision)</span>
</span><span class='line'><span class="s1">Installing knfsd (copyright (C) 1996 okir@monad.swb.de).</span>
</span><span class='line'><span class="s1">jffs2: version 2.2. (NAND) © 2001-2006 Red Hat, Inc.</span>
</span><span class='line'><span class="s1">ROMFS MTD (C) 2007 Red Hat, Inc.</span>
</span><span class='line'><span class="s1">msgmni has been set to 246</span>
</span><span class='line'><span class="s1">Block layer SCSI generic (bsg) driver version 0.4 loaded (major 254)</span>
</span><span class='line'><span class="s1">io scheduler noop registered</span>
</span><span class='line'><span class="s1">io scheduler deadline registered</span>
</span><span class='line'><span class="s1">io scheduler cfq registered (default)</span>
</span><span class='line'><span class="s1">clcd-pl11x dev:20: PL110 rev0 at 0x10120000</span>
</span><span class='line'><span class="s1">clcd-pl11x dev:20: Versatile hardware, VGA display</span>
</span><span class='line'><span class="s1">Console: switching to colour frame buffer device 80x60</span>
</span><span class='line'><span class="s1">brd: module loaded</span>
</span><span class='line'><span class="s1">physmap platform flash device: 04000000 at 34000000</span>
</span><span class='line'><span class="s1">physmap-flash.0: Found 1 x32 devices at 0x0 in 32-bit bank. Manufacturer ID 0x000000 Chip ID 0x000000</span>
</span><span class='line'><span class="s1">Intel/Sharp Extended Query Table at 0x0031</span>
</span><span class='line'><span class="s1">Using buffer write method</span>
</span><span class='line'><span class="s1">smc91x.c: v1.1, sep 22 2004 by Nicolas Pitre &lt;nico@fluxnic.net&gt;</span>
</span><span class='line'><span class="s1">eth0: SMC91C11xFD (rev 1) at c89c8000 IRQ 57 [nowait]</span>
</span><span class='line'><span class="s1">eth0: Ethernet addr: 52:54:00:12:34:56</span>
</span><span class='line'><span class="s1">mousedev: PS/2 mouse device common for all mice</span>
</span><span class='line'><span class="s1">TCP: cubic registered</span>
</span><span class='line'><span class="s1">NET: Registered protocol family 17</span>
</span><span class='line'><span class="s1">VFP support v0.3: implementor 41 architecture 1 part 10 variant 9 rev 0</span>
</span><span class='line'><span class="s1">eth0: link up</span>
</span><span class='line'><span class="s1">Sending DHCP requests ., OK</span>
</span><span class='line'><span class="s1">IP-Config: Got DHCP answer from 192.168.1.1, my address is 192.168.1.13</span>
</span><span class='line'><span class="s1">IP-Config: Complete:</span>
</span><span class='line'><span class="s1">     device=eth0, hwaddr=52:54:00:12:34:56, ipaddr=192.168.1.13, mask=255.255.255.0, gw=192.168.1.1</span>
</span><span class='line'><span class="s1">     host=192.168.1.13, domain=, nis-domain=(none)</span>
</span><span class='line'><span class="s1">     bootserver=0.0.0.0, rootserver=192.168.1.24, rootpath=</span>
</span><span class='line'><span class="s1">     nameserver0=192.168.1.1</span>
</span><span class='line'><span class="s1">input: AT Raw Set 2 keyboard as /devices/fpga:06/serio0/input/input0</span>
</span><span class='line'><span class="s1">input: ImExPS/2 Generic Explorer Mouse as /devices/fpga:07/serio1/input/input1</span>
</span><span class='line'><span class="s1">VFS: Mounted root (nfs filesystem) on device 0:9.</span>
</span><span class='line'><span class="s1">Freeing unused kernel memory: 112K (c034e000 - c036a000)</span>
</span><span class='line'>
</span><span class='line'><span class="s1">Please press Enter to activate this console. </span>
</span><span class='line'><span class="s1">/bin/ash: can&#39;</span>t access tty; job control turned off
</span><span class='line'>/ <span class="c"># </span>
</span></code></pre></td></tr></table></div></figure>


<p><a id="summary"></a></p>

<h3>Summary</h3>

<p>This setup need few minor tweaks like adding U-Boot environment variables
storage to not enter it every time or removing annoying message <code>can't access
tty(...)</code>. I&rsquo;m done for now, its time to take care about other challenges. I
hope that I will back to this issues in near future. If you like this series
please share it, if somethings wrong please comment I will try to help if can.</p>

<p><a href="http://bec-systems.com/site/418/how-to-set-up-a-nfs-rootfs">How to set up a NFS root filesystem for embedded Linux development</a></p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">pietrushnic</span></span>

      








  <img class="center" src="/assets/images/icons/clock.ico" width="12" height="12">



<time datetime="2013-06-07T10:40:00+02:00" pubdate data-updated="true">Jun 7<span>th</span>, 2013</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/embedded/'>embedded</a>, <a class='category' href='/blog/categories/linux/'>linux</a>, <a class='category' href='/blog/categories/vdb/'>vdb</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://pietrushnic.github.io/blog/2013/06/07/root-file-system-for-embedded-system/" data-via="pietrushnic" data-counturl="http://pietrushnic.github.io/blog/2013/06/07/root-file-system-for-embedded-system/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2013/06/07/qemu-network-configuration-and-tftp-for-virtual-development-board/" title="Previous Post: 0x5: Qemu network configuration and tftp for Virtual Development Board">&laquo; 0x5: Qemu network configuration and tftp for Virtual Development Board</a>
      
      
        <a class="basic-alignment right" href="/blog/2013/07/30/how-to-use-google-search-activity-to-improve-productivity/" title="Next Post: Improve productivity with Goolge history using bookmarks and Chrome extensions">Improve productivity with Goolge history using bookmarks and Chrome extensions &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>About Me</h1>
  <img class="center" src="/assets/images/photo.jpg" width="210" height="210">
  <p>I'm a freedom and liberty enthusiast with broad range of interests begining 
  with linux, through austrian economics and ending with chess and bridge. If you want to 
  read more extroverted idle talk about me take a look <a href=/about >here</a>.
  </p>
  <a href="https://plus.google.com/u/0/115979497998056410813/posts/p/pub"><img src="/assets/images/icons/glyphicons_social_02_google_plus.png" title="G+"></a>
  <a href="https://twitter.com/pietrushnic"><img src="/assets/images/icons/glyphicons_social_31_twitter.png" title="Twitter"></a>
  <a href="http://pietrushnic.blogspot.com/"><img src="/assets/images/icons/glyphicons_social_05_blogger.png" title="Blogger"></a>
  <a href="https://github.com/pietrushnic"><img src="/assets/images/icons/glyphicons_social_21_github.png" title="Github"></a>
  <a href="http://www.youtube.com/user/pietrushnic"><img src="/assets/images/icons/glyphicons_social_22_youtube.png" title="Youtube"></a>
  <a href="http://www.linkedin.com/in/krolpiotr"><img src="/assets/images/icons/glyphicons_social_17_linked_in.png" title="LinkedIn"></a>
  <a href="mailto:pietrushnic@gmail.com"><img src="/assets/images/icons/glyphicons_social_39_e-mail.png" title="e-mail"></a>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2013/07/30/how-to-use-google-search-activity-to-improve-productivity/">Improve productivity with Goolge history using bookmarks and Chrome extensions</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/06/07/root-file-system-for-embedded-system/">0x6: Root file system for embedded system</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/06/07/qemu-network-configuration-and-tftp-for-virtual-development-board/">0x5: Qemu network configuration and tftp for Virtual Development Board</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/06/07/linux-kernel-for-embedded-system/">0x4: Linux kernel for embedded system</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/06/07/embedded-board-bootloader/">0x3: Embedded board bootloader</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/pietrushnic">@pietrushnic</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'pietrushnic',
            count: 3,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


<section class="lastfm">
<h1>Recently Scrobbled</h1>
<style type="text/css">
  #lastfmList li{ text-align: left; }
</style>
<ul id="lastfmList">
  <li class="loading">Updating tracks...</li>
</ul>
<script lang="Javascript">
    /*
     * JavaScript Pretty Date
     * Copyright (c) 2011 John Resig (ejohn.org)
     * Licensed under the MIT and GPL licenses.
     */

    // Takes an ISO time and returns a string representing how
    // long ago the date represents.
    function prettyDate(time){
        diff = ((new Date()).getTime()/1000 - time),
        day_diff = Math.floor(diff / 86400);

      if ( isNaN(day_diff) || day_diff < 0 || day_diff >= 31 )
        return;

      return day_diff == 0 && (
          diff < 60 && "just now" ||
          diff < 120 && "1 minute" ||
          diff < 3600 && Math.floor( diff / 60 ) + " minutes" ||
          diff < 7200 && "1 hour" ||
          diff < 86400 && Math.floor( diff / 3600 ) + " hours") ||
        day_diff == 1 && "Yesterday" ||
        day_diff < 7 && day_diff + " days" ||
        day_diff < 31 && Math.ceil( day_diff / 7 ) + " weeks";
    }
</script>
<script lang="Javascript">
    function showLastfmFeed(json){
        if(json.recenttracks == 'undefined'){
            return
        }

        var tracklist = document.getElementById('lastfmList'),
            content = '';

        $.each(json.recenttracks.track, function(i, track){
            var interval = prettyDate(track.date['uts']);
            content += '<li id="lastfmItem_'+i+'"><a href="'+ track.url + '">' + track.name +'</a> by '+ track.artist['#text'] + '<span class="date"> ' + interval  + ( interval == 'just now' ? '' :' ago') + '</span></li>';
        });

        tracklist.innerHTML = content;
    }
</script>
<script lang="Javascript" src="http://ws.audioscrobbler.com/2.0/?method=user.getrecenttracks&user=cl4sh&limit=5&api_key=caffa61565e03c9fc347fa409e20778f&format=json&callback=showLastfmFeed"></script>
</section>


  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - pietrushnic -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'pietrushnics-world';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://pietrushnic.github.io/blog/2013/06/07/root-file-system-for-embedded-system/';
        var disqus_url = 'http://pietrushnic.github.io/blog/2013/06/07/root-file-system-for-embedded-system/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>





  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
